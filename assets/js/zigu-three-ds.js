!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ThreeDS=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function t(t,e,n,r){return new(n||(n=Promise))((function(i,o){function s(t){try{u(r.next(t))}catch(t){o(t)}}function a(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function e(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},n(t,e)};function r(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function i(t){return"function"==typeof t}var o=!1,s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;o=t},get useDeprecatedSynchronousErrorHandling(){return o}};function a(t){setTimeout((function(){throw t}),0)}var u={closed:!0,next:function(t){},error:function(t){if(s.useDeprecatedSynchronousErrorHandling)throw t;a(t)},complete:function(){}},c=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function l(t){return null!==t&&"object"==typeof t}var d=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=d,p=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,r=n._parentOrParents,o=n._ctorUnsubscribe,s=n._unsubscribe,a=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var u=0;u<r.length;++u){r[u].remove(this)}if(i(s)){o&&(this._unsubscribe=void 0);try{s.call(this)}catch(t){e=t instanceof h?f(t.errors):[t]}}if(c(a)){u=-1;for(var d=a.length;++u<d;){var p=a[u];if(l(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof h?e=e.concat(f(t.errors)):e.push(t)}}}if(e)throw new h(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function f(t){return t.reduce((function(t,e){return t.concat(e instanceof h?e.errors:e)}),[])}var b=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),m=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=u;break;case 1:if(!n){o.destination=u;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new y(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new y(o,n,r,i)}return o}return r(e,t),e.prototype[b]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(p),y=function(t){function e(e,n,r,o){var s,a=t.call(this)||this;a._parentSubscriber=e;var c=a;return i(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==u&&(i((c=Object.create(n)).unsubscribe)&&a.add(c.unsubscribe.bind(c)),c.unsubscribe=a.unsubscribe.bind(a))),a._context=c,a._next=s,a._error=r,a._complete=o,a}return r(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;s.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=s.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):a(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;a(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};s.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw t;a(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return s.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(a(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(m);var v=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function w(t){return t}function g(t){return 0===t.length?w:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var E=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof m)return t;if(t[b])return t[b]()}return t||e||n?new m(t,e,n):new m(u)}(t,e,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||s.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),s.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){s.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof m?r:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=A(e))((function(e,r){var i;i=n.subscribe((function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}}),r,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:g(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=A(t))((function(t,n){var r;e.subscribe((function(t){return r=t}),(function(t){return n(t)}),(function(){return t(r)}))}))},t.create=function(e){return new t(e)},t}();function A(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}var _=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),S=function(t){function e(e,n){var r=t.call(this)||this;return r.subject=e,r.subscriber=n,r.closed=!1,r}return r(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(p),x=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return r(e,t),e}(m),C=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r(e,t),e.prototype[b]=function(){return new x(this)},e.prototype.lift=function(t){var e=new T(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new _;if(!this.isStopped)for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new _;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,r=e.slice(),i=0;i<n;i++)r[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new _;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),r=0;r<e;r++)n[r].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new _;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new _;return this.hasError?(t.error(this.thrownError),p.EMPTY):this.isStopped?(t.complete(),p.EMPTY):(this.observers.push(t),new S(this,t))},e.prototype.asObservable=function(){var t=new E;return t.source=this,t},e.create=function(t,e){return new T(t,e)},e}(E),T=function(t){function e(e,n){var r=t.call(this)||this;return r.destination=e,r.source=n,r}return r(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):p.EMPTY},e}(C),D=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.pending=!1,r}return r(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,r=void 0;try{this.work(t)}catch(t){n=!0,r=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return r(e,t),e.prototype.schedule=function(t,e){return this},e}(p)),I=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}();function k(t){return t&&"function"==typeof t.schedule}var M=new(function(t){function e(n,r){void 0===r&&(r=I.now);var i=t.call(this,n,(function(){return e.delegate&&e.delegate!==i?e.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return r(e,t),e.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,r,i):t.prototype.schedule.call(this,n,r,i)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(I))(D);function q(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new O(t,e))}}var O=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new R(t,this.project,this.thisArg))},t}(),R=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(m),j=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(m),L=function(t){function e(e,n,r){var i=t.call(this)||this;return i.parent=e,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(m);function P(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var H=P(),U=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function N(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var F=function(t){if(t&&"function"==typeof t[v])return i=t,function(t){var e=i[v]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(U(t))return r=t,function(t){for(var e=0,n=r.length;e<n&&!t.closed;e++)t.next(r[e]);t.complete()};if(N(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,a),t};if(t&&"function"==typeof t[H])return e=t,function(t){for(var n=e[H]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,r,i,o=l(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+o+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function X(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[v]}(t))return function(t,e){return new E((function(n){var r=new p;return r.add(e.schedule((function(){var i=t[v]();r.add(i.subscribe({next:function(t){r.add(e.schedule((function(){return n.next(t)})))},error:function(t){r.add(e.schedule((function(){return n.error(t)})))},complete:function(){r.add(e.schedule((function(){return n.complete()})))}}))}))),r}))}(t,e);if(N(t))return function(t,e){return new E((function(n){var r=new p;return r.add(e.schedule((function(){return t.then((function(t){r.add(e.schedule((function(){n.next(t),r.add(e.schedule((function(){return n.complete()})))})))}),(function(t){r.add(e.schedule((function(){return n.error(t)})))}))}))),r}))}(t,e);if(U(t))return function(t,e){return new E((function(n){var r=new p,i=0;return r.add(e.schedule((function(){i!==t.length?(n.next(t[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}(t,e);if(function(t){return t&&"function"==typeof t[H]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new E((function(n){var r,i=new p;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(e.schedule((function(){r=t[H](),i.add(e.schedule((function(){if(!n.closed){var t,e;try{var i=r.next();t=i.value,e=i.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function K(t,e){return e?X(t,e):t instanceof E?t:new E(F(t))}var z=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(m),V=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(m);function Y(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(r){return r.pipe(Y((function(n,r){return K(t(n,r)).pipe(q((function(t,i){return e(n,t,r,i)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new B(t,n))})}var B=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.project,this.concurrent))},t}(),J=function(t){function e(e,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new z(this),n=this.destination;n.add(e);var r=function(t,e){if(!e.closed){if(t instanceof E)return t.subscribe(e);var n;try{n=F(t)(e)}catch(t){e.error(t)}return n}}(t,e);r!==e&&n.add(r)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(V);function G(t){return!c(t)&&t-parseFloat(t)+1>=0}function W(t,e,n){void 0===t&&(t=0);var r=-1;return G(e)?r=Number(e)<1?1:Number(e):k(e)&&(n=e),k(n)||(n=M),new E((function(e){var i=G(t)?t:+t-n.now();return n.schedule($,i,{index:0,period:r,subscriber:e})}))}function $(t){var e=t.index,n=t.period,r=t.subscriber;if(r.next(e),!r.closed){if(-1===n)return r.complete();t.index=e+1,this.schedule(t,n)}}function Z(t,e){return Y(t,e,1)}var Q=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.delayDurationSelector))},t}(),tt=function(t){function e(e,n){var r=t.call(this,e)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return r(e,t),e.prototype.notifyNext=function(t,e,n,r,i){this.destination.next(t),this.removeSubscription(i),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){var e=this.index++;try{var n=this.delayDurationSelector(t,e);n&&this.tryDelay(n,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},e.prototype.tryDelay=function(t,e){var n=function(t,e,n,r,i){if(void 0===i&&(i=new L(t,n,r)),!i.closed)return e instanceof E?e.subscribe(i):F(e)(i)}(this,t,e);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(j),et=function(t){function e(e,n){var r=t.call(this)||this;return r.source=e,r.subscriptionDelay=n,r}return r(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new nt(t,this.source))},e}(E),nt=function(t){function e(e,n){var r=t.call(this)||this;return r.parent=e,r.source=n,r.sourceSubscribed=!1,r}return r(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(m);var rt=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new it(t,this.count,this.source))},t}(),it=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.count=n,i.source=r,i}return r(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return t.prototype.error.call(this,e);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},e}(m);var ot=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new st(t,this.predicate,this.inclusive))},t}(),st=function(t){function e(e,n,r){var i=t.call(this,e)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return r(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(m),at="undefined"!=typeof window&&window,ut="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,ct="undefined"!=typeof global&&global,lt=at||ct||ut;function dt(t,e){return void 0===e&&(e=null),new vt({method:"GET",url:t,headers:e})}function ht(t,e,n){return new vt({method:"POST",url:t,body:e,headers:n})}function pt(t,e){return new vt({method:"DELETE",url:t,headers:e})}function ft(t,e,n){return new vt({method:"PUT",url:t,body:e,headers:n})}function bt(t,e,n){return new vt({method:"PATCH",url:t,body:e,headers:n})}var mt=q((function(t,e){return t.response}));function yt(t,e){return mt(new vt({method:"GET",url:t,responseType:"json",headers:e}))}var vt=function(t){function e(e){var n=t.call(this)||this,r={async:!0,createXHR:function(){return this.crossDomain?function(){if(lt.XMLHttpRequest)return new lt.XMLHttpRequest;if(lt.XDomainRequest)return new lt.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(lt.XMLHttpRequest)return new lt.XMLHttpRequest;var t=void 0;try{for(var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(t=e[n],new lt.ActiveXObject(t))break}catch(t){}return new lt.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)r.url=e;else for(var i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);return n.request=r,n}var n;return r(e,t),e.prototype._subscribe=function(t){return new wt(t,this.request)},e.create=((n=function(t){return new e(t)}).get=dt,n.post=ht,n.delete=pt,n.put=ft,n.patch=bt,n.getJSON=yt,n),e}(E),wt=function(t){function e(e,n){var r=t.call(this,e)||this;r.request=n,r.done=!1;var i=n.headers=n.headers||{};return n.crossDomain||r.getHeader(i,"X-Requested-With")||(i["X-Requested-With"]="XMLHttpRequest"),r.getHeader(i,"Content-Type")||lt.FormData&&n.body instanceof lt.FormData||void 0===n.body||(i["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=r.serializeBody(n.body,r.getHeader(n.headers,"Content-Type")),r.send(),r}return r(e,t),e.prototype.next=function(t){this.done=!0;var e,n=this,r=n.xhr,i=n.request,o=n.destination;try{e=new gt(t,r,i)}catch(t){return o.error(t)}o.next(e)},e.prototype.send=function(){var t=this.request,e=this.request,n=e.user,r=e.method,i=e.url,o=e.async,s=e.password,a=e.headers,u=e.body;try{var c=this.xhr=t.createXHR();this.setupEvents(c,t),n?c.open(r,i,o,n,s):c.open(r,i,o),o&&(c.timeout=t.timeout,c.responseType=t.responseType),"withCredentials"in c&&(c.withCredentials=!!t.withCredentials),this.setHeaders(c,a),u?c.send(u):c.send()}catch(t){this.error(t)}},e.prototype.serializeBody=function(t,e){if(!t||"string"==typeof t)return t;if(lt.FormData&&t instanceof lt.FormData)return t;if(e){var n=e.indexOf(";");-1!==n&&(e=e.substring(0,n))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&");case"application/json":return JSON.stringify(t);default:return t}},e.prototype.setHeaders=function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setRequestHeader(n,e[n])},e.prototype.getHeader=function(t,e){for(var n in t)if(n.toLowerCase()===e.toLowerCase())return t[n]},e.prototype.setupEvents=function(t,e){var n=e.progressSubscriber;function r(t){var e,n=r,i=n.subscriber,o=n.progressSubscriber,s=n.request;o&&o.error(t);try{e=new _t(this,s)}catch(t){e=t}i.error(e)}if(t.ontimeout=r,r.request=e,r.subscriber=this,r.progressSubscriber=n,t.upload&&"withCredentials"in t){var i,o;if(n)i=function(t){i.progressSubscriber.next(t)},lt.XDomainRequest?t.onprogress=i:t.upload.onprogress=i,i.progressSubscriber=n;o=function(t){var e,n=o,r=n.progressSubscriber,i=n.subscriber,s=n.request;r&&r.error(t);try{e=new Et("ajax error",this,s)}catch(t){e=t}i.error(e)},t.onerror=o,o.request=e,o.subscriber=this,o.progressSubscriber=n}function s(t){}function a(t){var e=a,n=e.subscriber,r=e.progressSubscriber,i=e.request;if(4===this.readyState){var o=1223===this.status?204:this.status,s="text"===this.responseType?this.response||this.responseText:this.response;if(0===o&&(o=s?200:0),o<400)r&&r.complete(),n.next(t),n.complete();else{r&&r.error(t);var u=void 0;try{u=new Et("ajax error "+o,this,i)}catch(t){u=t}n.error(u)}}}t.onreadystatechange=s,s.subscriber=this,s.progressSubscriber=n,s.request=e,t.onload=a,a.subscriber=this,a.progressSubscriber=n,a.request=e},e.prototype.unsubscribe=function(){var e=this.done,n=this.xhr;!e&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),t.prototype.unsubscribe.call(this)},e}(m),gt=function(){return function(t,e,n){this.originalEvent=t,this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=At(this.responseType,e)}}(),Et=function(){function t(t,e,n){return Error.call(this),this.message=t,this.name="AjaxError",this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=At(this.responseType,e),this}return t.prototype=Object.create(Error.prototype),t}();function At(t,e){switch(t){case"json":return function(t){return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null")}(e);case"xml":return e.responseXML;default:return"response"in e?e.response:e.responseText}}var _t=function(t,e){return Et.call(this,"ajax timeout",t,e),this.name="AjaxTimeoutError",this},St=function(){return vt.create}();function xt(t){return function(t){if(Array.isArray(t))return Ct(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Ct(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ct(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ct(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Tt,Dt,It,kt,Mt,qt=(Tt=["a[href]","area[href]",'input:not([disabled]):not([type="hidden"]):not([aria-hidden])',"select:not([disabled]):not([aria-hidden])","textarea:not([disabled]):not([aria-hidden])","button:not([disabled]):not([aria-hidden])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],Dt=function(){function t(e){var n=e.targetModal,r=e.triggers,i=void 0===r?[]:r,o=e.onShow,s=void 0===o?function(){}:o,a=e.onClose,u=void 0===a?function(){}:a,c=e.openTrigger,l=void 0===c?"data-micromodal-trigger":c,d=e.closeTrigger,h=void 0===d?"data-micromodal-close":d,p=e.openClass,f=void 0===p?"is-open":p,b=e.disableScroll,m=void 0!==b&&b,y=e.disableFocus,v=void 0!==y&&y,w=e.awaitCloseAnimation,g=void 0!==w&&w,E=e.awaitOpenAnimation,A=void 0!==E&&E,_=e.debugMode,S=void 0!==_&&_;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.modal=document.getElementById(n),this.config={debugMode:S,disableScroll:m,openTrigger:l,closeTrigger:h,openClass:f,onShow:s,onClose:u,awaitCloseAnimation:g,awaitOpenAnimation:A,disableFocus:v},i.length>0&&this.registerTriggers.apply(this,xt(i)),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}var e;return(e=[{key:"registerTriggers",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.filter(Boolean).forEach((function(e){e.addEventListener("click",(function(e){return t.showModal(e)}))}))}},{key:"showModal",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.activeElement=document.activeElement,this.modal.setAttribute("aria-hidden","false"),this.modal.classList.add(this.config.openClass),this.scrollBehaviour("disable"),this.addEventListeners(),this.config.awaitOpenAnimation){var n=function e(){t.modal.removeEventListener("animationend",e,!1),t.setFocusToFirstNode()};this.modal.addEventListener("animationend",n,!1)}else this.setFocusToFirstNode();this.config.onShow(this.modal,this.activeElement,e)}},{key:"closeModal",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.modal;if(this.modal.setAttribute("aria-hidden","true"),this.removeEventListeners(),this.scrollBehaviour("enable"),this.activeElement&&this.activeElement.focus&&this.activeElement.focus(),this.config.onClose(this.modal,this.activeElement,t),this.config.awaitCloseAnimation){var n=this.config.openClass;this.modal.addEventListener("animationend",(function t(){e.classList.remove(n),e.removeEventListener("animationend",t,!1)}),!1)}else e.classList.remove(this.config.openClass)}},{key:"closeModalById",value:function(t){this.modal=document.getElementById(t),this.modal&&this.closeModal()}},{key:"scrollBehaviour",value:function(t){if(this.config.disableScroll){var e=document.querySelector("body");switch(t){case"enable":Object.assign(e.style,{overflow:""});break;case"disable":Object.assign(e.style,{overflow:"hidden"})}}}},{key:"addEventListeners",value:function(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}},{key:"removeEventListeners",value:function(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}},{key:"onClick",value:function(t){(t.target.hasAttribute(this.config.closeTrigger)||t.target.parentNode.hasAttribute(this.config.closeTrigger))&&(t.preventDefault(),t.stopPropagation(),this.closeModal(t))}},{key:"onKeydown",value:function(t){27===t.keyCode&&this.closeModal(t),9===t.keyCode&&this.retainFocus(t)}},{key:"getFocusableNodes",value:function(){var t=this.modal.querySelectorAll(Tt);return Array.apply(void 0,xt(t))}},{key:"setFocusToFirstNode",value:function(){var t=this;if(!this.config.disableFocus){var e=this.getFocusableNodes();if(0!==e.length){var n=e.filter((function(e){return!e.hasAttribute(t.config.closeTrigger)}));n.length>0&&n[0].focus(),0===n.length&&e[0].focus()}}}},{key:"retainFocus",value:function(t){var e=this.getFocusableNodes();if(0!==e.length)if(e=e.filter((function(t){return null!==t.offsetParent})),this.modal.contains(document.activeElement)){var n=e.indexOf(document.activeElement);t.shiftKey&&0===n&&(e[e.length-1].focus(),t.preventDefault()),!t.shiftKey&&e.length>0&&n===e.length-1&&(e[0].focus(),t.preventDefault())}else e[0].focus()}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}(),It=null,kt=function(t){if(!document.getElementById(t))return console.warn("MicroModal: ❗Seems like you have missed %c'".concat(t,"'"),"background-color: #f8f9fa;color: #50596c;font-weight: bold;","ID somewhere in your code. Refer example below to resolve it."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<div class="modal" id="'.concat(t,'"></div>')),!1},Mt=function(t,e){if(function(t){t.length<=0&&(console.warn("MicroModal: ❗Please specify at least one %c'micromodal-trigger'","background-color: #f8f9fa;color: #50596c;font-weight: bold;","data attribute."),console.warn("%cExample:","background-color: #f8f9fa;color: #50596c;font-weight: bold;",'<a href="#" data-micromodal-trigger="my-modal"></a>'))}(t),!e)return!0;for(var n in e)kt(n);return!0},{init:function(t){var e=Object.assign({},{openTrigger:"data-micromodal-trigger"},t),n=xt(document.querySelectorAll("[".concat(e.openTrigger,"]"))),r=function(t,e){var n=[];return t.forEach((function(t){var r=t.attributes[e].value;void 0===n[r]&&(n[r]=[]),n[r].push(t)})),n}(n,e.openTrigger);if(!0!==e.debugMode||!1!==Mt(n,r))for(var i in r){var o=r[i];e.targetModal=i,e.triggers=xt(o),It=new Dt(e)}},show:function(t,e){var n=e||{};n.targetModal=t,!0===n.debugMode&&!1===kt(t)||(It&&It.removeEventListeners(),(It=new Dt(n)).showModal())},close:function(t){t?It.closeModalById(t):It.closeModal()}});"undefined"!=typeof window&&(window.MicroModal=qt);return function(){function n(n){var r=this;this.requestMethod="GET",this.waitTime=5e3,this.version="2.1.1",this.challengeIndicator="01",this.fingerprintV1="https://threeds.zigudevel.com/functions/v1/fingerprint",this.fingerprintV2="https://threeds.zigudevel.com/functions/v2/fingerprint",this.$stop=new C,this.iframeClass=null,this.useDialog=!1,this.dialogID="threeds-modal",this.dialogContentID="threeds-modal-content",this.open3DS=function(t){var e=t.url,n=t.paReq,i=t.termUrl,o=t.transId,s="w_"+Date.now()+Math.floor(1e5*Math.random()).toString(),a=document.createElement("form");a.setAttribute("method","post"),a.setAttribute("action",e),a.setAttribute("target",s);var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","PaReq"),u.setAttribute("value",n);var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","TermUrl"),c.setAttribute("value",i);var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","transId"),l.setAttribute("value",o),a.appendChild(u),a.appendChild(c),a.appendChild(l),document.body.appendChild(a);var d=window.open("",s);r.window=d,a.submit()},this.open3DSManual=function(t){var e=t.paReq,n=t.redirectUrl,i=t.md,o=t.acsURL,s=t.transId,a="w_"+Date.now()+Math.floor(1e5*Math.random()).toString(),u=document.createElement("form");u.setAttribute("method","post"),u.setAttribute("action",r.gatewayUrl+"/3ds/v1-3/fingerprint"),u.setAttribute("target",a);var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","paReq"),c.setAttribute("value",e);var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","redirectUrl"),l.setAttribute("value",n);var d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","md"),d.setAttribute("value",i);var h=document.createElement("input");h.setAttribute("type","hidden"),h.setAttribute("name","acsURL"),h.setAttribute("value",o);var p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","threeDsApiKey"),p.setAttribute("value",r.apiKey);var f=document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","auth"),f.setAttribute("value",r.auth);var b=document.createElement("input");b.setAttribute("type","hidden"),b.setAttribute("name","transId"),b.setAttribute("value",s),u.appendChild(c),u.appendChild(l),u.appendChild(d),u.appendChild(h),u.appendChild(p),u.appendChild(f),u.appendChild(b),document.body.appendChild(u);var m=window.open("",a);r.window=m,u.submit()},this.open3DSManualForm=function(t,e){if(r.iframeClass){var n,i=document.createElement("iframe");if(i.setAttribute("name",t),i.style.minHeight="400px",i.style.minWidth="400px",r.useDialog)(n=document.getElementById(r.dialogContentID))&&(r.removeAllChildNodes(n),null==n||n.appendChild(i)),e.submit(),qt.show(r.dialogID);else(n=document.getElementById(r.iframeClass))&&(r.removeAllChildNodes(n),null==n||n.appendChild(i)),e.submit()}else{var o=window.open("",t);r.window=o,e.submit()}},this.open3DSManualFingerprintV1=function(t){var e=t.paReq,n=t.redirectUrl,i=t.md,o=t.acsURL,s=t.transId,a="w_"+Date.now()+Math.floor(1e5*Math.random()).toString(),u=document.createElement("form");u.setAttribute("method","post"),u.setAttribute("action",r.fingerprintV1),u.setAttribute("target",a);var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","paReq"),c.setAttribute("value",e);var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","redirectUrl"),l.setAttribute("value",n);var d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","md"),d.setAttribute("value",i);var h=document.createElement("input");h.setAttribute("type","hidden"),h.setAttribute("name","acsURL"),h.setAttribute("value",o);var p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","threeDsApiKey"),p.setAttribute("value",r.apiKey);var f=document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","auth"),f.setAttribute("value",r.auth);var b=document.createElement("input");b.setAttribute("type","hidden"),b.setAttribute("name","transId"),b.setAttribute("value",s);var m=document.createElement("input");m.setAttribute("type","hidden"),m.setAttribute("name","threedsurl"),m.setAttribute("value",r.threeDsUrl),u.appendChild(c),u.appendChild(l),u.appendChild(d),u.appendChild(h),u.appendChild(p),u.appendChild(f),u.appendChild(b),u.appendChild(m),document.body.appendChild(u),r.open3DSManualForm(a,u)},this.open3DSManualFingerprintV2=function(t){var e=t.redirectUrl,n=t.transId,i=t.methodURL,o=t.threeDSMethodData,s="w_"+Date.now()+Math.floor(1e5*Math.random()).toString(),a=document.createElement("form");a.setAttribute("method","post"),a.setAttribute("action",r.fingerprintV2),a.setAttribute("target",s);var u=document.createElement("input");u.setAttribute("type","hidden"),u.setAttribute("name","redirectUrl"),u.setAttribute("value",e||"");var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","threeDsApiKey"),c.setAttribute("value",r.apiKey);var l=document.createElement("input");l.setAttribute("type","hidden"),l.setAttribute("name","auth"),l.setAttribute("value",r.auth);var d=document.createElement("input");d.setAttribute("type","hidden"),d.setAttribute("name","transId"),d.setAttribute("value",n);var h=document.createElement("input");h.setAttribute("type","hidden"),h.setAttribute("name","methodURL"),h.setAttribute("value",i);var p=document.createElement("input");p.setAttribute("type","hidden"),p.setAttribute("name","threeDSMethodData"),p.setAttribute("value",o);var f=document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name","threedsurl"),f.setAttribute("value",r.threeDsUrl),a.appendChild(u),a.appendChild(c),a.appendChild(l),a.appendChild(d),a.appendChild(h),a.appendChild(p),a.appendChild(f),document.body.appendChild(a),r.open3DSManualForm(s,a)},this.generateAuth=function(){return t(r,void 0,void 0,(function(){var t,n,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=this.threeDsUrl+"/v2/authorize",[4,fetch(t,{method:"POST",headers:{Accept:"application/json","content-type":"application/json","X-3DS-API-KEY":this.apiKey}})];case 1:if(n=e.sent(),this.auth=n.headers.get("Authorization")||"",n.status>=400||""===this.auth)throw new Error("Error al generar Autenticación");return[3,3];case 2:throw r=e.sent(),new Error(r.message);case 3:return[2]}}))}))},this.getBrowserInfo=function(){return{browserAcceptHeader:"application/json",browserJavaEnabled:window.navigator.javaEnabled(),browserJavaScriptEnabled:!0,browserLanguage:window.navigator.language,browserColorDepth:window.screen.colorDepth.toString(),browserScreenWidth:window.screen.width.toString(),browserScreenHeight:window.screen.height.toString(),browserTZ:(new Date).getTimezoneOffset().toString(),browserUserAgent:window.navigator.userAgent}},this.request3DSAuthenticate=function(n){return t(r,void 0,void 0,(function(){var t,r,i,o,s;return e(this,(function(e){switch(e.label){case 0:return[4,this.generateAuth()];case 1:return e.sent(),t={browser:this.getBrowserInfo(),challengeIndicator:this.challengeIndicator,amount:n.total,pan:n.number,month:n.expiryMonth,year:n.expiryYear,protocolVersion:this.version,threeDSRequestorURL:this.host},n.billing&&(t.billing=n.billing),n.shipping&&(t.billing=n.shipping),n.merchantRiskIndicator&&(t.merchantRiskIndicator=n.merchantRiskIndicator),n.currency&&(t.currency=n.currency),n.cardHolderName&&(t.cardHolderName=n.cardHolderName),n.email&&(t.email=n.email),n.transType&&(t.transType=n.transType),r=this.threeDsUrl+"/v2/authenticate/browser",[4,fetch(r,{method:"POST",headers:this.getHeaders(),body:JSON.stringify(t)})];case 2:return(i=e.sent()).status>=400?[4,i.json()]:[3,4];case 3:throw o=e.sent(),s=o.error||"Error al intentar generar petición de 3ds",new Error(s);case 4:return[4,i.json()];case 5:return[2,e.sent()]}}))}))},this.request3DS=function(n){return t(r,void 0,void 0,(function(){var t,r;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.request3DSAuthenticate(n)];case 1:return(t=e.sent())&&("2"===t.protocolVersion.substring(0,1)?(this.transId=t.transactionId,t.threeDSMethodData&&this.open3DSManualFingerprintV2({methodURL:t.methodURL||"",threeDSMethodData:t.threeDSMethodData||"",transId:this.transId})):(this.transId=t.TransactionId||"",this.open3DSManualFingerprintV1({paReq:t.PaReq||"",transId:t.TransactionId||"",redirectUrl:t.TermUrl||"",md:t.MD||"",acsURL:t.AcsUrl||t.AcsURL||""}))),[3,3];case 2:throw r=e.sent(),new Error(r.message);case 3:return[2]}}))}))},this.subscribe=function(){return new Promise((function(n,i){r.interval=setInterval((function(){return t(r,void 0,void 0,(function(){var t,r,o,s;return e(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=this,[4,this.send()];case 1:return t.result=e.sent(),clearInterval(this.interval),(o=JSON.parse(this.result.responseText||null))&&(null===(s=this.window)||void 0===s||s.close(),n(o)),[3,3];case 2:return r=e.sent(),this.httpRequest.status>=400&&(clearInterval(this.interval),o=JSON.parse(r.responseText||null),i(o)),[3,3];case 3:return[2]}}))}))}),r.waitTime)}))},this.$subscribe=function(){var t,e,n,i=function(){return St({crossDomain:!0,createXHR:function(){return new window.XMLHttpRequest},method:"GET",url:r.getEndPoint(),headers:{"Content-Type":"application/json","X-3DS-API-KEY":r.apiKey,Authorization:r.auth}}).pipe((t=function(t){var e=t.status,n=null==t?void 0:t.response;return 200===e&&"C"===n.status?W(3e3):W(10)},e?function(n){return new et(n,e).lift(new Q(t))}:function(e){return e.lift(new Q(t))}));var t,e};return K(Array.from(Array(200))).pipe(Z((function(){return i()})),(e=function(t){null==t||t.status;var e=null==t?void 0:t.response,n=null==e?void 0:e.status;return"N"!==n&&"Y"!==n},void 0===(n=!0)&&(n=!1),function(t){return t.lift(new ot(e,n))}),(void 0===(t=10)&&(t=-1),function(e){return e.lift(new rt(t,e))}))},this.request3DSFull=function(n){return t(r,void 0,void 0,(function(){var t=this;return e(this,(function(e){switch(e.label){case 0:return[4,this.request3DS(n)];case 1:return e.sent(),[2,new Promise((function(e,n){var r;t.$subscribe().subscribe({next:function(t){r=t.response},error:function(t){n(t.message)},complete:function(){var n;null===(n=t.window)||void 0===n||n.close(),e(r)}})}))]}}))}))},this.apiKey=n.apiKey,this.auth=n.auth||"",this.endpoint=n.endpoint||"",this.transId=n.transId||"",this.httpRequest=new XMLHttpRequest,this.window=null,this.charge=null,this.host=n.host||"",this.sandbox=n.sandbox||!1,this.sandbox?(this.threeDsUrl="https://api-sandbox.3dsintegrator.com",this.gatewayUrl="https://gateway2.zigu.mx"):(this.threeDsUrl="https://api.3dsintegrator.com",this.gatewayUrl="https://gateway2.zigu.mx"),n.threeDsUrl&&(this.threeDsUrl=n.threeDsUrl),n.version&&(this.version=n.version),n.challengeIndicator&&(this.challengeIndicator=n.challengeIndicator),n.useDialog&&(this.useDialog=n.useDialog),n.iframeClass&&(this.iframeClass=n.iframeClass,this.useDialog&&(this.makeDialogDiv(),qt.init(),this.addStyle('\n    /**************************     Basic Modal Styles\n    **************************/\n\n    .modal {\n        font-family: -apple-system,BlinkMacSystemFont,avenir next,avenir,helvetica neue,helvetica,ubuntu,roboto,noto,segoe ui,arial,sans-serif;\n    }\n\n    .modal__overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: rgba(0,0,0,0.6);\n        display: flex;\n        justify-content: center;\n        align-items: center;\n    }\n\n    .modal__container {\n        background-color: #fff;\n        padding: 30px;\n        max-width: 500px;\n        max-height: 100vh;\n        border-radius: 4px;\n        overflow-y: auto;\n        box-sizing: border-box;\n    }\n\n    .modal__header {\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n    }\n\n    .modal__title {\n        margin-top: 0;\n        margin-bottom: 0;\n        font-weight: 600;\n        font-size: 1.25rem;\n        line-height: 1.25;\n        color: #00449e;\n        box-sizing: border-box;\n    }\n\n    .modal__close {\n        background: transparent;\n        border: 0;\n    }\n\n    .modal__header .modal__close:before { content: "2715"; }\n\n    .modal__content {\n        margin-top: 2rem;\n        margin-bottom: 2rem;\n        line-height: 1.5;\n        color: rgba(0,0,0,.8);\n    }\n\n    .modal__btn {\n        font-size: .875rem;\n        padding-left: 1rem;\n        padding-right: 1rem;\n        padding-top: .5rem;\n        padding-bottom: .5rem;\n        background-color: #e6e6e6;\n        color: rgba(0,0,0,.8);\n        border-radius: .25rem;\n        border-style: none;\n        border-width: 0;\n        cursor: pointer;\n        -webkit-appearance: button;\n        text-transform: none;\n        overflow: visible;\n        line-height: 1.15;\n        margin: 0;\n        will-change: transform;\n        -moz-osx-font-smoothing: grayscale;\n        -webkit-backface-visibility: hidden;\n        backface-visibility: hidden;\n        -webkit-transform: translateZ(0);\n        transform: translateZ(0);\n        transition: -webkit-transform .25s ease-out;\n        transition: transform .25s ease-out;\n        transition: transform .25s ease-out,-webkit-transform .25s ease-out;\n    }\n\n    .modal__btn:focus, .modal__btn:hover {\n        -webkit-transform: scale(1.05);\n        transform: scale(1.05);\n    }\n\n    .modal__btn-primary {\n        background-color: #00449e;\n        color: #fff;\n    }\n\n\n\n    /**************************     Demo Animation Style\n    **************************/\n    @keyframes mmfadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n    }\n\n    @keyframes mmfadeOut {\n        from { opacity: 1; }\n        to { opacity: 0; }\n    }\n\n    @keyframes mmslideIn {\n    from { transform: translateY(15%); }\n        to { transform: translateY(0); }\n    }\n\n    @keyframes mmslideOut {\n        from { transform: translateY(0); }\n        to { transform: translateY(-10%); }\n    }\n\n    .micromodal-slide {\n        display: none;\n    }\n\n    .micromodal-slide.is-open {\n        display: block;\n    }\n\n    .micromodal-slide[aria-hidden="false"] .modal__overlay {\n        animation: mmfadeIn .3s cubic-bezier(0.0, 0.0, 0.2, 1);\n    }\n\n    .micromodal-slide[aria-hidden="false"] .modal__container {\n        animation: mmslideIn .3s cubic-bezier(0, 0, .2, 1);\n    }\n\n    .micromodal-slide[aria-hidden="true"] .modal__overlay {\n        animation: mmfadeOut .3s cubic-bezier(0.0, 0.0, 0.2, 1);\n    }\n\n    .micromodal-slide[aria-hidden="true"] .modal__container {\n        animation: mmslideOut .3s cubic-bezier(0, 0, .2, 1);\n    }\n\n    .micromodal-slide .modal__container,\n    .micromodal-slide .modal__overlay {\n        will-change: transform;\n    }\n')))}return n.prototype.createXHR=function(){return new XMLHttpRequest},n.prototype.init=function(){return this.httpRequest||(this.httpRequest=new XMLHttpRequest),this.httpRequest.open(this.requestMethod,this.endpoint),this.httpRequest},n.prototype.setHeaders=function(){return this.httpRequest.setRequestHeader("Content-Type","application/json"),this.httpRequest.setRequestHeader("X-3DS-API-KEY",this.apiKey),this.httpRequest.setRequestHeader("Authorization",this.auth),this.httpRequest},n.prototype.getEndPoint=function(){return this.endpoint||(this.endpoint=this.threeDsUrl+"/v2/transaction/"+this.transId+"/updates"),this.endpoint},n.prototype.getHeaders=function(){return{Accept:"application/json","X-3DS-API-KEY":this.apiKey,"Content-Type":"application/json",Authorization:this.auth}},n.prototype.send=function(t){var e=this;return void 0===t&&(t=null),this.getEndPoint(),this.init(),this.setHeaders(),new Promise((function(n,r){e.httpRequest.addEventListener("load",(function(t){e.httpRequest.status>=400?r(e.httpRequest):n(e.httpRequest)})),e.httpRequest.addEventListener("error",(function(t){r(e.httpRequest)})),e.httpRequest.send(null!=t?JSON.stringify(t):t)}))},n.prototype.addStyle=function(t){var e=document.createElement("style");e.textContent=t,document.head.append(e)},n.prototype.removeAllChildNodes=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},n.prototype.makeDialogDiv=function(){var t=document.createElement("div");t.classList.add("modal"),t.classList.add("micromodal-slide"),t.setAttribute("id",this.dialogID),t.setAttribute("aria-hidden","true");var e=document.createElement("div");e.classList.add("modal__overlay"),e.setAttribute("tabindex","-1"),e.setAttribute("data-micromodal-close","");var n=document.createElement("div");n.classList.add("modal__container"),n.setAttribute("role","dialog"),n.setAttribute("aria-modal","true"),n.setAttribute("aria-labelledby","modal-1-title");var r=document.createElement("header");r.classList.add("modal__header");var i=document.createElement("h2");i.classList.add("modal__title"),i.setAttribute("id","modal-1-title"),i.textContent="Autenticación 3DS";var o=document.createElement("button");o.classList.add("modal__close"),o.setAttribute("aria-label","Close modal"),o.setAttribute("data-micromodal-close","");var s=document.createElement("main");s.classList.add("modal__content"),s.setAttribute("id","modal-1-content");var a=document.createElement("div");a.setAttribute("id",this.dialogContentID);var u=document.createElement("footer");u.classList.add("modal__footer");var c=document.createElement("button");c.classList.add("modal__btn"),c.setAttribute("data-micromodal-close",""),c.setAttribute("aria-label","Cerrar dialogo"),c.textContent="Cerrar",r.appendChild(i),r.appendChild(o),s.appendChild(a),u.appendChild(c),n.appendChild(r),n.appendChild(s),n.appendChild(u),e.appendChild(n),t.appendChild(e);var l=document.getElementById(this.iframeClass||"");l&&(null==l||l.appendChild(t))},n}()}));